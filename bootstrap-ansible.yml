# bootstrap-ansible.yml
# This playbook installs required Ansible collections directly from their git repos.
- name: "Bootstrap Ansible dependencies"
  hosts: localhost
  connection: local

  vars:
    # Define the base path where Ansible looks for collections
    galaxy_collections_path: "{{ ansible_env.HOME }}/.ansible/collections/ansible_collections"

  - name: "Ensure collection directories are removed before cloning"
      become: yes
        ansible.builtin.file:
          path: "{{ item }}"
          state: absent
      loop:
          - "{{ galaxy_collections_path }}/community/general"
          - "{{ galaxy_collections_path }}/kewlfft/aur"

  tasks:
    - name: "Install community.general collection via git"
      become: yes
      ansible.builtin.git:
        repo: 'https://github.com/ansible-collections/community.general.git'
        dest: "{{ galaxy_collections_path }}/community/general"
        version: stable-9
        force: yes # <-- Update repo if it already exists

    - name: "Install AUR collection via git"
      become: yes
      ansible.builtin.git:
        repo: 'https://github.com/kewlfft/ansible-aur.git'
        dest: "{{ galaxy_collections_path }}/kewlfft/aur"
        version: master
        force: yes # <-- For consistency and idempotency
