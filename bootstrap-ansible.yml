# bootstrap-ansible.yml
# This playbook installs required Ansible collections, bypassing the Galaxy
# resolver for the problematic community.aur collection.
- name: "Bootstrap Ansible dependencies"
  hosts: localhost
  connection: local

  vars:
    # Define the base path where Ansible looks for collections
    galaxy_collections_path: "{{ ansible_env.HOME }}/.ansible/collections/ansible_collections"

  tasks:
    - name: "Install community.general collection via ansible-galaxy"
      become: yes
      ansible.builtin.command: "ansible-galaxy collection install community.general"
      args:
        # Prevents re-running if the collection is already installed
        creates: "{{ galaxy_collections_path }}/community/general"

    - name: "Install community.aur collection via git clone"
      become: yes
      ansible.builtin.git:
        repo: 'https://github.com/ansible-collections/community.aur.git'
        dest: "{{ galaxy_collections_path }}/community/aur"
        version: main
